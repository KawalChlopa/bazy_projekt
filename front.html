<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel testowy bukmachera</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body class="container mt-4">
    <h1 class="mb-4">Panel testowy bukmachera</h1>

    <!-- Zarządzanie kontem -->
    <div class="section">
        <h2>Zarządzanie kontem</h2>
        
        <!-- Tworzenie konta -->
        <div class="mb-4">
            <h3>Tworzenie konta</h3>
            <form id="createAccountForm">
                <div class="mb-3">
                    <input type="text" class="form-control" id="nazwa" placeholder="Nazwa użytkownika">
                </div>
                <div class="mb-3">
                    <input type="password" class="form-control" id="haslo" placeholder="Hasło">
                </div>
                <div class="mb-3">
                    <input type="email" class="form-control" id="email" placeholder="Email">
                </div>
                <button type="submit" class="btn btn-primary">Utwórz konto</button>
            </form>
        </div>

        <!-- Lista użytkowników -->
        <div class="mb-4">
            <h3>Lista użytkowników</h3>
            <button onclick="getAccounts()" class="btn btn-info">Pobierz listę</button>
            <div id="accountsList" class="mt-2"></div>
        </div>

        <!-- Usuwanie konta -->
        <div class="mb-4">
            <h3>Usuwanie konta</h3>
            <form id="deleteAccountForm">
                <div class="mb-3">
                    <input type="number" class="form-control" id="deleteUserId" placeholder="ID użytkownika">
                </div>
                <button type="submit" class="btn btn-danger">Usuń konto</button>
            </form>
        </div>

        <!-- Reset hasła -->
        <div class="mb-4">
            <h3>Reset hasła</h3>
            <form id="resetPasswordForm">
                <div class="mb-3">
                    <input type="text" class="form-control" id="resetUsername" placeholder="Nazwa użytkownika">
                </div>
                <div class="mb-3">
                    <input type="password" class="form-control" id="newPassword" placeholder="Nowe hasło">
                </div>
                <button type="submit" class="btn btn-warning">Resetuj hasło</button>
            </form>
        </div>
    </div>

    <!-- Zarządzanie zakładami -->
    <div class="section">
        <h2>Zarządzanie zakładami</h2>
        
        <!-- Wyszukiwanie meczu -->
        <div class="mb-4">
            <h3>Wyszukiwanie meczu</h3>
            <form id="findMatchForm">
                <div class="mb-3">
                    <input type="text" class="form-control" id="searchQuery" placeholder="Nazwa drużyny">
                </div>
                <button type="submit" class="btn btn-primary">Szukaj</button>
            </form>
            <div id="matchResults" class="mt-2"></div>
        </div>

        <!-- Stawianie zakładu -->
        <div class="mb-4">
            <h3>Stawianie zakładu</h3>
            <form id="placeBetForm">
                <div class="mb-3">
                    <input type="number" class="form-control" id="betUserId" placeholder="ID użytkownika">
                </div>
                <div class="mb-3">
                    <input type="number" class="form-control" id="betOddsId" placeholder="ID kursu">
                </div>
                <div class="mb-3">
                    <input type="number" class="form-control" id="betAmount" placeholder="Kwota zakładu" step="0.01">
                </div>
                <button type="submit" class="btn btn-success">Postaw zakład</button>
            </form>
        </div>

        <!-- Rozliczanie meczu -->
        <div class="mb-4">
            <h3>Rozliczanie meczu</h3>
            <form id="settleMatchForm">
                <div class="mb-3">
                    <input type="number" class="form-control" id="matchId" placeholder="ID meczu">
                </div>
                <button type="submit" class="btn btn-info">Rozlicz mecz</button>
            </form>
        </div>
    </div>

    <!-- Zarządzanie kursami -->
    <div class="section">
        <h2>Zarządzanie kursami</h2>
        
        <!-- Dodawanie kursu -->
        <div class="mb-4">
            <h3>Dodawanie kursu</h3>
            <form id="addOddsForm">
                <div class="mb-3">
                    <input type="number" class="form-control" id="matchIdForOdds" placeholder="ID meczu">
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="oddsType" placeholder="Typ kursu">
                </div>
                <div class="mb-3">
                    <input type="number" class="form-control" id="oddsValue" placeholder="Wartość kursu" step="0.01">
                </div>
                <button type="submit" class="btn btn-primary">Dodaj kurs</button>
            </form>
        </div>

        <!-- Lista kursów -->
        <div class="mb-4">
            <h3>Lista kursów dla meczu</h3>
            <form id="getOddsForm">
                <div class="mb-3">
                    <input type="number" class="form-control" id="matchIdForList" placeholder="ID meczu">
                </div>
                <button type="submit" class="btn btn-info">Pobierz kursy</button>
            </form>
            <div id="oddsList" class="mt-2"></div>
        </div>
    </div>

    <!-- Sprawdzanie bilansu -->
    <div class="section">
        <h2>Bilans użytkownika</h2>
        <form id="checkBalanceForm">
            <div class="mb-3">
                <input type="number" class="form-control" id="userIdForBalance" placeholder="ID użytkownika">
            </div>
            <button type="submit" class="btn btn-info">Sprawdź bilans</button>
        </form>
        <div id="balanceResults" class="mt-2"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';

        // Tworzenie konta
        document.getElementById('createAccountForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                nazwa: document.getElementById('nazwa').value,
                haslo: document.getElementById('haslo').value,
                email: document.getElementById('email').value
            };
            
            try {
                const response = await fetch(`${API_URL}/konto`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.message || result.error);
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });

        // Pobieranie listy użytkowników
        async function getAccounts() {
            try {
                const response = await fetch(`${API_URL}/konto`);
                const users = await response.json();
                const usersList = document.getElementById('accountsList');
                usersList.innerHTML = `<table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nazwa</th>
                            <th>Email</th>
                            <th>Balans</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>${user.id_uzytkownika}</td>
                                <td>${user.nazwa}</td>
                                <td>${user.email}</td>
                                <td>${user.balans}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        }

        // Usuwanie konta
        document.getElementById('deleteAccountForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const userId = document.getElementById('deleteUserId').value;
            
            try {
                const response = await fetch(`${API_URL}/konto/${userId}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                alert(result.message || result.error);
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });

        // Reset hasła
        document.getElementById('resetPasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                nazwa: document.getElementById('resetUsername').value,
                new_password: document.getElementById('newPassword').value
            };
            
            try {
                const response = await fetch(`${API_URL}/konto/reset_password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.message || result.error);
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });

        // Wyszukiwanie meczu
        document.getElementById('findMatchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = document.getElementById('searchQuery').value;
            
            try {
                const response = await fetch(`${API_URL}/konto/find_match?search=${encodeURIComponent(query)}`);
                const matches = await response.json();
                const resultsDiv = document.getElementById('matchResults');
                resultsDiv.innerHTML = `<table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Gospodarz</th>
                            <th>Gość</th>
                            <th>Data</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${matches.map(match => `
                            <tr>
                                <td>${match.id_meczu}</td>
                                <td>${match.gospodarz}</td>
                                <td>${match.gosc}</td>
                                <td>${new Date(match.data_meczu).toLocaleString()}</td>
                                <td>${match.status}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });

        // Stawianie zakładu
        document.getElementById('placeBetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                id_uzytkownika: parseInt(document.getElementById('betUserId').value),
                id_kursu: parseInt(document.getElementById('betOddsId').value),
                kwota_postawiona: parseFloat(document.getElementById('betAmount').value)
            };
            
            try {
                const response = await fetch(`${API_URL}/zaklad`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.message || result.error);
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });

        // Rozliczanie meczu
        document.getElementById('settleMatchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                id_meczu: parseInt(document.getElementById('matchId').value)
            };
            
            try {
                const response = await fetch(`${API_URL}/rozlicz_mecz`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.message || result.error);
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });

        // Dodawanie kursu
        document.getElementById('addOddsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const matchId = document.getElementById('matchIdForOdds').value;
            const data = {
                nazwa_typu: document.getElementById('oddsType').value,
                kurs: parseFloat(document.getElementById('oddsValue').value)
            };
            
            try {
                const response = await fetch(`${API_URL}/mecz/${matchId}/kursy`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.message || result.error);
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });

        // Pobieranie listy kursów
        document.getElementById('getOddsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const matchId = document.getElementById('matchIdForList').value;
            
            try {
                const response = await fetch(`${API_URL}/mecz/${matchId}/kursy`);
                const odds = await response.json();
                const oddsListDiv = document.getElementById('oddsList');
                oddsListDiv.innerHTML = `<table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Typ</th>
                            <th>Kurs</th>
                            <th>Data utworzenia</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${odds.map(odd => `
                            <tr>
                                <td>${odd.id}</td>
                                <td>${odd.nazwa_typu}</td>
                                <td>${odd.kurs}</td>
                                <td>${new Date(odd.data_utworzenia).toLocaleString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });

        // Sprawdzanie bilansu
        document.getElementById('checkBalanceForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const userId = document.getElementById('userIdForBalance').value;
            
            try {
                const response = await fetch(`${API_URL}/konto/${userId}/bilans`);
                const balance = await response.json();
                const balanceDiv = document.getElementById('balanceResults');
                
                // Wyświetlanie transakcji
                let transactionsHtml = `
                    <h4 class="mt-3">Transakcje</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Typ operacji</th>
                                <th>Suma kwot</th>
                                <th>Liczba transakcji</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${balance.transakcje.map(t => `
                                <tr>
                                    <td>${t.typ_operacji}</td>
                                    <td>${t.suma_kwota}</td>
                                    <td>${t.liczba_transakcji}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>`;

                // Wyświetlanie statystyk
                let statsHtml = `
                    <h4 class="mt-3">Statystyki zakładów</h4>
                    <table class="table">
                        <tr>
                            <td>Wygrane zakłady:</td>
                            <td>${balance.statystyki.wygrane_zaklady}</td>
                        </tr>
                        <tr>
                            <td>Przegrane zakłady:</td>
                            <td>${balance.statystyki.przegrane_zaklady}</td>
                        </tr>
                        <tr>
                            <td>Suma wygranych:</td>
                            <td>${balance.statystyki.suma_wygranych}</td>
                        </tr>
                        <tr>
                            <td>Suma przegranych:</td>
                            <td>${balance.statystyki.suma_przegranych}</td>
                        </tr>
                        <tr>
                            <td>Procent wygranych:</td>
                            <td>${balance.statystyki.procent_wygranych}%</td>
                        </tr>
                    </table>`;

                // Wyświetlanie historii operacji
                let historyHtml = `
                    <h4 class="mt-3">Historia operacji</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Typ operacji</th>
                                <th>Kwota</th>
                                <th>Zmiana balansu</th>
                                <th>Saldo po operacji</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${balance.ostatnie_operacje.map(op => `
                                <tr>
                                    <td>${new Date(op.data).toLocaleString()}</td>
                                    <td>${op.typ_operacji}</td>
                                    <td>${op.kwota}</td>
                                    <td>${op.zmiana_balansu}</td>
                                    <td>${op.saldo_po_operacji}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>`;

                balanceDiv.innerHTML = transactionsHtml + statsHtml + historyHtml;
            } catch (error) {
                alert('Wystąpił błąd: ' + error);
            }
        });
    </script>
</body>
</html>